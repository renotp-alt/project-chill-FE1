<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CHILL — Selengkapnya</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div data-include="header"></div>

  <main id="detail" class="detail">
    <section class="hero">
      <div class="hero-media" id="heroMedia" role="img" aria-label=""></div>
      <button class="close-hero" onclick="history.back()" aria-label="Tutup">✕</button>

      <div class="hero-info">
        <h1 id="title"></h1>
        <div class="meta" id="meta"></div>

        <div class="actions">
          <a class="btn primary" id="btnPlay" href="#">Mulai</a>
          <button class="btn" id="btnAdd" title="Tambah ke daftar">+</button>
        </div>

        <p id="overview"></p>

        <dl class="info">
          <div><dt>Cast</dt><dd id="cast"></dd></div>
          <div><dt>Genre</dt><dd id="genres"></dd></div>
          <div><dt>Pembuat Film</dt><dd id="creators"></dd></div>
        </dl>
      </div>
    </section>

    <section class="episodes" id="episodesSec" hidden>
      <h2>Episode</h2>
      <ol id="episodesList" class="episodes-list"></ol>
    </section>
  </main>

  <script src="js/header.js" defer></script>
  <script>
    (async function init(){
      const params = new URLSearchParams(location.search);
      const id = params.get('id');
      if(!id){ location.href = 'home.html'; return; }

      const data =
        (await fetch('/assets/movies.json').catch(()=>null)) ||
        (await fetch('assets/movies.json').catch(()=>null));

      const movies = data && data.ok ? await data.json() : [];
      const movie = movies.find(m=>String(m.id) === String(id));
      if(!movie){ location.href = 'home.html'; return; }

      const hero = document.getElementById('heroMedia');
      const titleEl = document.getElementById('title');
      const metaEl = document.getElementById('meta');
      const overview = document.getElementById('overview');
      const cast = document.getElementById('cast');
      const genres = document.getElementById('genres');
      const creators = document.getElementById('creators');

      const heroBg = movie.backdrop || movie.poster;
      if(heroBg) hero.style.backgroundImage = `url('${heroBg}')`;
      hero.setAttribute('aria-label', movie.title || '');

      titleEl.textContent = movie.title || '';
      metaEl.textContent = [movie.year, movie.duration, movie.rating].filter(Boolean).join('  ·  ');
      overview.textContent = movie.overview || '';
      cast.textContent = (movie.cast || []).join(', ');
      genres.textContent = (movie.genres || []).join(', ');
      creators.textContent = (movie.creators || []).join(', ');

      // Episode (khusus series)
      if((movie.type || '').toLowerCase() === 'series' && Array.isArray(movie.episodes)){
        const sec = document.getElementById('episodesSec');
        const list = document.getElementById('episodesList');
        sec.hidden = false;

        const fallbackImg = movie.backdrop || movie.poster || '';
        list.innerHTML = movie.episodes.map(ep=>{
          const img = ep.image && ep.image.trim() ? ep.image : fallbackImg;
          return `
            <li class="episode-card">
              <div class="episode-no">${ep.no ?? ''}</div>
              <div class="episode-thumb" style="background-image:url('${img}')"></div>
              <div>
                <div class="episode-title">${ep.title ?? ''}</div>
                <div class="episode-desc">${ep.desc ?? ''}</div>
              </div>
              <div class="episode-runtime">${ep.runtime ?? ''}</div>
            </li>
          `;
        }).join('');
      }
    })();
  </script>
</body>
</html>

